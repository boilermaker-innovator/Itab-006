<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kickstarter iTabs Generator - Create Interactive Campaign Displays | itabs.ai</title>

    <!-- SEO & Social -->
    <meta name="description" content="Turn your Kickstarter campaign into an interactive visual story. AI-powered iTabs generator creates clickable displays that boost engagement and conversions.">
    <meta property="og:title" content="Kickstarter iTabs Generator - itabs.ai">
    <meta property="og:description" content="Turn your Kickstarter campaign into an interactive visual story people actually engage with.">
    <meta property="og:image" content="https://i.ibb.co/kickstarter-itabs-preview.jpg">
    <meta property="og:url" content="https://itabs.ai/kickstarter">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üöÄ</text></svg>">

    <!-- Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            /* Kickstarter Brand Colors */
            --ks-green: #05CE78;
            --ks-green-dark: #00A862;
            --ks-green-light: #E8FBF2;
            
            /* Neutrals */
            --text-dark: #1a1a2e;
            --text-mid: #4a5568;
            --text-light: #718096;
            --bg-white: #ffffff;
            --bg-grey: #f7f8fa;
            --border-light: #e2e8f0;
            
            /* Status Colors */
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(180deg, var(--ks-green-light) 0%, var(--bg-grey) 25%);
            min-height: 100vh;
            color: var(--text-dark);
        }

        /* ========== LAYOUT ========== */
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        @media (min-width: 1024px) {
            .app-container {
                display: grid;
                grid-template-columns: 1fr 450px;
                gap: 30px;
                padding: 30px;
            }
        }

        /* ========== HEADER ========== */
        .header {
            text-align: center;
            margin-bottom: 25px;
            grid-column: 1 / -1;
        }

        .header h1 {
            font-size: 2.2em;
            font-weight: 700;
            color: var(--ks-green);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .header p {
            color: var(--text-mid);
            font-size: 1.1em;
        }

        .header .badge {
            display: inline-block;
            background: var(--ks-green);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: 600;
            margin-top: 10px;
        }

        /* ========== PANELS ========== */
        .form-panel {
            background: var(--bg-white);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .preview-panel {
            background: var(--bg-white);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            position: sticky;
            top: 20px;
            height: fit-content;
        }

        @media (max-width: 1023px) {
            .preview-panel {
                margin-top: 25px;
                position: static;
            }
        }

        /* ========== FORM SECTIONS ========== */
        .form-section {
            margin-bottom: 28px;
            padding: 22px;
            background: var(--bg-grey);
            border-radius: 14px;
            border: 1px solid var(--border-light);
        }

        .section-title {
            font-size: 1.15em;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: var(--ks-green);
            border-radius: 2px;
        }

        label {
            display: block;
            font-size: 0.9em;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 6px;
        }

        input[type="text"],
        input[type="url"],
        textarea {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid var(--border-light);
            border-radius: 10px;
            font-size: 0.95em;
            font-family: inherit;
            transition: border-color 0.2s, box-shadow 0.2s;
            background: var(--bg-white);
            margin-bottom: 16px;
        }

        input:focus,
        textarea:focus {
            outline: none;
            border-color: var(--ks-green);
            box-shadow: 0 0 0 3px rgba(5, 206, 120, 0.1);
        }

        textarea {
            min-height: 90px;
            resize: vertical;
        }

        .helper-text {
            font-size: 0.82em;
            color: var(--text-light);
            margin-top: -12px;
            margin-bottom: 16px;
            line-height: 1.4;
        }

        /* ========== INFO BOX ========== */
        .info-box {
            background: linear-gradient(135deg, var(--ks-green-light) 0%, #f0fff8 100%);
            border-left: 4px solid var(--ks-green);
            padding: 14px 16px;
            border-radius: 0 10px 10px 0;
            margin-bottom: 18px;
            font-size: 0.9em;
            color: var(--text-mid);
            line-height: 1.6;
        }

        .info-box strong {
            color: var(--ks-green-dark);
        }

        .info-box a {
            color: var(--ks-green);
            font-weight: 600;
        }

        /* ========== BUTTONS ========== */
        .btn {
            width: 100%;
            padding: 14px 20px;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--ks-green) 0%, var(--ks-green-dark) 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(5, 206, 120, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(5, 206, 120, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: var(--bg-white);
            color: var(--ks-green);
            border: 2px solid var(--ks-green);
        }

        .btn-secondary:hover {
            background: var(--ks-green-light);
        }

        .btn-danger {
            background: var(--error);
            color: white;
        }

        .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .btn-group .btn {
            flex: 1;
        }

        /* ========== STEP INDICATOR ========== */
        .steps {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 25px;
        }

        .step {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9em;
            background: var(--border-light);
            color: var(--text-light);
            transition: all 0.3s;
        }

        .step.active {
            background: var(--ks-green);
            color: white;
            transform: scale(1.1);
        }

        .step.complete {
            background: var(--success);
            color: white;
        }

        /* ========== IMAGE INPUTS ========== */
        .image-inputs {
            background: var(--bg-white);
            border-radius: 12px;
            padding: 16px;
            border: 2px dashed rgba(5, 206, 120, 0.3);
        }

        .image-input-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .image-input-row input {
            flex: 1;
            margin-bottom: 0;
        }

        .image-input-row .remove-btn {
            width: 38px;
            height: 38px;
            border-radius: 8px;
            background: var(--error);
            color: white;
            border: none;
            font-size: 1.2em;
            cursor: pointer;
            flex-shrink: 0;
        }

        .add-image-btn {
            width: 100%;
            padding: 12px;
            background: transparent;
            border: 2px dashed var(--ks-green);
            border-radius: 10px;
            color: var(--ks-green);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .add-image-btn:hover {
            background: var(--ks-green-light);
        }

        /* ========== LOADING STATE ========== */
        .loading-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(255,255,255,0.95);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .loading-overlay.show {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border-light);
            border-top-color: var(--ks-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--text-dark);
        }

        /* ========== ERROR/SUCCESS MESSAGES ========== */
        .message {
            padding: 14px 18px;
            border-radius: 10px;
            margin-bottom: 18px;
            font-size: 0.9em;
            display: none;
        }

        .message.show {
            display: block;
        }

        .message.error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
        }

        .message.success {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #16a34a;
        }

        /* ========== PREVIEW CARD ========== */
        .preview-title {
            text-align: center;
            font-size: 1.3em;
            font-weight: 600;
            color: var(--ks-green);
            margin-bottom: 20px;
        }

        .preview-placeholder {
            background: linear-gradient(135deg, var(--ks-green) 0%, var(--ks-green-dark) 100%);
            border-radius: 16px;
            padding: 60px 30px;
            text-align: center;
            color: white;
        }

        .preview-placeholder h3 {
            font-size: 1.3em;
            margin-bottom: 12px;
        }

        .preview-placeholder p {
            opacity: 0.9;
        }

        #livePreview {
            display: none;
        }

        #livePreview.show {
            display: block;
        }

        /* ========== CODE OUTPUT ========== */
        .code-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid var(--border-light);
            display: none;
        }

        .code-section.show {
            display: block;
        }

        .code-output {
            background: #1a202c;
            color: #68d391;
            padding: 18px;
            border-radius: 12px;
            font-family: 'Fira Code', 'Courier New', monospace;
            font-size: 0.8em;
            max-height: 250px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-bottom: 15px;
        }

        /* ========== TOGGLE SWITCH ========== */
        .toggle-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 16px;
            background: var(--bg-white);
            border-radius: 10px;
            margin-bottom: 16px;
        }

        .toggle-label {
            font-weight: 500;
            color: var(--text-dark);
        }

        .toggle-switch {
            position: relative;
            width: 52px;
            height: 28px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 28px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle-switch input:checked + .toggle-slider {
            background-color: var(--ks-green);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        /* ========== RANGE SLIDER ========== */
        .range-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 16px;
        }

        .range-row input[type="range"] {
            flex: 1;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: var(--border-light);
            border-radius: 3px;
            outline: none;
            margin: 0;
            padding: 0;
        }

        .range-row input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--ks-green);
            border-radius: 50%;
            cursor: pointer;
        }

        .range-value {
            min-width: 70px;
            font-weight: 600;
            color: var(--ks-green);
            text-align: right;
        }

        /* ========== SAVED STATUS ========== */
        .saved-status {
            background: #d1fae5;
            border: 1px solid #6ee7b7;
            color: #047857;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 0.85em;
            font-weight: 500;
            text-align: center;
            margin-bottom: 20px;
            display: none;
        }

        .saved-status.show {
            display: block;
        }

        /* ========== POPUP STYLES ========== */
        .popup-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.75);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 15px;
            backdrop-filter: blur(4px);
        }

        .popup-overlay.active {
            display: flex;
        }

        .popup {
            background: var(--bg-white);
            border-radius: 20px;
            max-width: 500px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(40px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .popup-header {
            background: linear-gradient(135deg, var(--ks-green) 0%, var(--ks-green-dark) 100%);
            color: white;
            padding: 24px;
            position: sticky;
            top: 0;
        }

        .popup-header h3 {
            font-size: 1.3em;
            margin-bottom: 4px;
        }

        .popup-header p {
            opacity: 0.9;
            font-size: 0.9em;
        }

        .close-btn {
            position: absolute;
            top: 14px;
            right: 14px;
            width: 32px;
            height: 32px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .popup-body {
            padding: 24px;
        }

        .popup-section {
            margin-bottom: 20px;
        }

        .popup-section h4 {
            color: var(--ks-green);
            font-size: 1.05em;
            margin-bottom: 8px;
        }

        .popup-section p {
            color: var(--text-mid);
            line-height: 1.7;
        }

        .popup-cta {
            display: block;
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--ks-green) 0%, var(--ks-green-dark) 100%);
            color: white;
            text-align: center;
            text-decoration: none;
            border-radius: 12px;
            font-weight: 600;
            margin-top: 20px;
        }

        /* ========== FUNDING STATS ========== */
        .funding-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .funding-grid input {
            margin-bottom: 0;
        }

        /* ========== FOOTER ========== */
        .footer {
            text-align: center;
            padding: 30px 20px;
            color: var(--text-light);
            font-size: 0.9em;
            grid-column: 1 / -1;
        }

        .footer a {
            color: var(--ks-green);
            text-decoration: none;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <div class="loading-text" id="loadingText">Generating your iTabs...</div>
    </div>

    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <h1>üöÄ Kickstarter iTabs Generator</h1>
            <p>Turn your campaign into an interactive display people can't ignore</p>
            <span class="badge">AI-Powered ‚Ä¢ Free to Use</span>
        </header>

        <!-- Form Panel -->
        <main class="form-panel">
            <!-- Saved Status -->
            <div class="saved-status" id="savedStatus">üíæ Your work is automatically saved!</div>

            <!-- Step 1: API Key -->
            <div class="form-section">
                <div class="section-title">üîë Step 1: Your AI Key</div>
                
                <div class="info-box">
                    <strong>One-time setup:</strong> Get a free Gemini API key from Google. 
                    <a href="https://aistudio.google.com/app/apikey" target="_blank">Get your key here ‚Üí</a><br>
                    Your key stays in your browser - never sent to our servers.
                </div>
                
                <label>Gemini API Key</label>
                <input type="text" id="geminiKey" placeholder="AIza..." oninput="saveToStorage()">
                <p class="helper-text">Paste your key once - we'll remember it for next time</p>
            </div>

            <!-- Step 2: Campaign Info -->
            <div class="form-section">
                <div class="section-title">üìã Step 2: Campaign Details</div>
                
                <label>Campaign Name *</label>
                <input type="text" id="campaignName" placeholder="e.g., The Ultimate Smart Watch" oninput="saveToStorage(); updatePreview()">
                
                <label>Kickstarter URL (optional)</label>
                <input type="url" id="campaignUrl" placeholder="https://kickstarter.com/projects/..." oninput="saveToStorage()">
                <p class="helper-text">Used for the "Back This Project" button</p>
                
                <label>Or paste your campaign description:</label>
                <textarea id="campaignText" placeholder="Paste your Kickstarter campaign description here and AI will organize it into clear sections..." oninput="saveToStorage()" rows="6"></textarea>
                
                <button class="btn btn-primary" onclick="generateWithAI()" id="generateBtn">
                    ‚ú® Generate iTabs Content with AI
                </button>
                
                <div class="message error" id="errorMsg"></div>
                <div class="message success" id="successMsg"></div>
            </div>

            <!-- Step 3: Images -->
            <div class="form-section">
                <div class="section-title">üì∏ Step 3: Campaign Images</div>
                
                <div class="info-box">
                    <strong>How to get image URLs:</strong><br>
                    1. Right-click any image on your Kickstarter page<br>
                    2. Select "Copy Image Address"<br>
                    3. Paste below (3-5 images work best)
                </div>
                
                <div class="image-inputs" id="imageInputs">
                    <div class="image-input-row">
                        <input type="url" class="image-url" placeholder="Image URL #1" oninput="saveToStorage(); updatePreview()">
                    </div>
                    <div class="image-input-row">
                        <input type="url" class="image-url" placeholder="Image URL #2" oninput="saveToStorage(); updatePreview()">
                    </div>
                    <div class="image-input-row">
                        <input type="url" class="image-url" placeholder="Image URL #3" oninput="saveToStorage(); updatePreview()">
                    </div>
                </div>
                <button class="add-image-btn" onclick="addImageInput()">+ Add Another Image (Max 5)</button>
            </div>

            <!-- Step 4: Edit Content -->
            <div class="form-section">
                <div class="section-title">‚úèÔ∏è Step 4: Edit Content</div>
                <p class="helper-text" style="margin-top: -10px; margin-bottom: 18px;">AI generates these - edit as needed</p>
                
                <label>üéØ What is it?</label>
                <textarea id="whatIsIt" placeholder="AI will generate this..." oninput="saveToStorage(); updatePreview()"></textarea>
                
                <label>üí° Why back this project?</label>
                <textarea id="whyBackIt" placeholder="AI will generate this..." oninput="saveToStorage(); updatePreview()"></textarea>
                
                <label>‚öôÔ∏è How does it work?</label>
                <textarea id="howWorks" placeholder="AI will generate this..." oninput="saveToStorage(); updatePreview()"></textarea>
                
                <label>‚≠ê What makes it special?</label>
                <textarea id="whatSpecial" placeholder="AI will generate this..." oninput="saveToStorage(); updatePreview()"></textarea>
            </div>

            <!-- Step 5: Funding Stats (Optional) -->
            <div class="form-section">
                <div class="section-title">üìä Step 5: Funding Stats (Optional)</div>
                <p class="helper-text" style="margin-top: -10px; margin-bottom: 18px;">Shows a progress bar in the popup - leave blank to hide</p>
                
                <div class="funding-grid">
                    <div>
                        <label>Amount Raised</label>
                        <input type="text" id="amountRaised" placeholder="e.g., $45,230" oninput="saveToStorage(); updatePreview()">
                    </div>
                    <div>
                        <label>Goal</label>
                        <input type="text" id="fundingGoal" placeholder="e.g., $50,000" oninput="saveToStorage(); updatePreview()">
                    </div>
                    <div>
                        <label>Backers</label>
                        <input type="text" id="backerCount" placeholder="e.g., 892" oninput="saveToStorage(); updatePreview()">
                    </div>
                    <div>
                        <label>Days Left</label>
                        <input type="text" id="daysLeft" placeholder="e.g., 12" oninput="saveToStorage(); updatePreview()">
                    </div>
                </div>
            </div>

            <!-- Step 6: Settings -->
            <div class="form-section">
                <div class="section-title">‚öôÔ∏è Step 6: Display Settings</div>
                
                <div class="toggle-row">
                    <span class="toggle-label">Auto-play slideshow</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="autoplayToggle" checked onchange="saveToStorage(); updatePreview()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                
                <label>Slideshow Speed</label>
                <div class="range-row">
                    <input type="range" id="autoplaySpeed" min="2" max="8" value="4" oninput="updateSpeedDisplay(); saveToStorage()">
                    <span class="range-value" id="speedValue">4 sec</span>
                </div>
                
                <label>Overlay Text (optional - shows on first image)</label>
                <input type="text" id="overlayText" placeholder="e.g., Now Live on Kickstarter!" oninput="saveToStorage(); updatePreview()">
                
                <label>Button Text</label>
                <input type="text" id="buttonText" value="Back This Project" oninput="saveToStorage(); updatePreview()">
            </div>

            <!-- Action Buttons -->
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="updatePreview()">üëÅÔ∏è Update Preview</button>
                <button class="btn btn-primary" onclick="generateCode()">üìã Generate Code</button>
            </div>

            <button class="btn btn-danger" style="margin-top: 15px;" onclick="clearAll()">üóëÔ∏è Clear All & Start Fresh</button>

            <!-- Code Output -->
            <div class="code-section" id="codeSection">
                <h3 style="color: var(--ks-green); margin-bottom: 15px;">üìã Your Embed Code</h3>
                <div class="code-output" id="codeOutput"></div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="copyCode()">üìã Copy Code</button>
                    <button class="btn btn-secondary" onclick="downloadHTML()">‚¨áÔ∏è Download HTML</button>
                </div>
            </div>
        </main>

        <!-- Preview Panel -->
        <aside class="preview-panel">
            <h2 class="preview-title">üëÅÔ∏è Live Preview</h2>
            
            <div id="previewPlaceholder" class="preview-placeholder">
                <h3>üé® Your iTabs appears here</h3>
                <p>Add images and content to see the magic!</p>
            </div>
            
            <div id="livePreview"></div>
        </aside>

        <!-- Footer -->
        <footer class="footer">
            <p>Made with ‚ù§Ô∏è by <a href="https://itabs.ai">iTabs.ai</a> ‚Äî Making information impossible to ignore</p>
        </footer>
    </div>

    <script>
        // ============ STORAGE ============
        const STORAGE_KEY = 'itabs_kickstarter_v1';
        
        function saveToStorage() {
            const data = {
                geminiKey: document.getElementById('geminiKey').value,
                campaignName: document.getElementById('campaignName').value,
                campaignUrl: document.getElementById('campaignUrl').value,
                campaignText: document.getElementById('campaignText').value,
                whatIsIt: document.getElementById('whatIsIt').value,
                whyBackIt: document.getElementById('whyBackIt').value,
                howWorks: document.getElementById('howWorks').value,
                whatSpecial: document.getElementById('whatSpecial').value,
                amountRaised: document.getElementById('amountRaised').value,
                fundingGoal: document.getElementById('fundingGoal').value,
                backerCount: document.getElementById('backerCount').value,
                daysLeft: document.getElementById('daysLeft').value,
                autoplay: document.getElementById('autoplayToggle').checked,
                autoplaySpeed: document.getElementById('autoplaySpeed').value,
                overlayText: document.getElementById('overlayText').value,
                buttonText: document.getElementById('buttonText').value,
                images: getImageUrls()
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            document.getElementById('savedStatus').classList.add('show');
        }
        
        function loadFromStorage() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (!saved) return;
            
            try {
                const data = JSON.parse(saved);
                
                if (data.geminiKey) document.getElementById('geminiKey').value = data.geminiKey;
                if (data.campaignName) document.getElementById('campaignName').value = data.campaignName;
                if (data.campaignUrl) document.getElementById('campaignUrl').value = data.campaignUrl;
                if (data.campaignText) document.getElementById('campaignText').value = data.campaignText;
                if (data.whatIsIt) document.getElementById('whatIsIt').value = data.whatIsIt;
                if (data.whyBackIt) document.getElementById('whyBackIt').value = data.whyBackIt;
                if (data.howWorks) document.getElementById('howWorks').value = data.howWorks;
                if (data.whatSpecial) document.getElementById('whatSpecial').value = data.whatSpecial;
                if (data.amountRaised) document.getElementById('amountRaised').value = data.amountRaised;
                if (data.fundingGoal) document.getElementById('fundingGoal').value = data.fundingGoal;
                if (data.backerCount) document.getElementById('backerCount').value = data.backerCount;
                if (data.daysLeft) document.getElementById('daysLeft').value = data.daysLeft;
                if (data.autoplay !== undefined) document.getElementById('autoplayToggle').checked = data.autoplay;
                if (data.autoplaySpeed) {
                    document.getElementById('autoplaySpeed').value = data.autoplaySpeed;
                    updateSpeedDisplay();
                }
                if (data.overlayText) document.getElementById('overlayText').value = data.overlayText;
                if (data.buttonText) document.getElementById('buttonText').value = data.buttonText;
                
                if (data.images && data.images.length > 0) {
                    const container = document.getElementById('imageInputs');
                    container.innerHTML = '';
                    data.images.forEach((url, i) => {
                        const row = document.createElement('div');
                        row.className = 'image-input-row';
                        row.innerHTML = `
                            <input type="url" class="image-url" placeholder="Image URL #${i+1}" value="${url}" oninput="saveToStorage(); updatePreview()">
                            ${i > 0 ? '<button class="remove-btn" onclick="removeImageInput(this)">√ó</button>' : ''}
                        `;
                        container.appendChild(row);
                    });
                }
                
                document.getElementById('savedStatus').classList.add('show');
                updatePreview();
            } catch (e) {
                console.error('Error loading saved data:', e);
            }
        }
        
        function clearAll() {
            if (confirm('This will clear all your work. Are you sure?')) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        }
        
        // ============ IMAGE INPUTS ============
        function getImageUrls() {
            const inputs = document.querySelectorAll('.image-url');
            return Array.from(inputs).map(i => i.value.trim()).filter(u => u);
        }
        
        function addImageInput() {
            const container = document.getElementById('imageInputs');
            const count = container.querySelectorAll('.image-input-row').length;
            
            if (count >= 5) {
                alert('Maximum 5 images allowed');
                return;
            }
            
            const row = document.createElement('div');
            row.className = 'image-input-row';
            row.innerHTML = `
                <input type="url" class="image-url" placeholder="Image URL #${count+1}" oninput="saveToStorage(); updatePreview()">
                <button class="remove-btn" onclick="removeImageInput(this)">√ó</button>
            `;
            container.appendChild(row);
            saveToStorage();
        }
        
        function removeImageInput(btn) {
            btn.parentElement.remove();
            saveToStorage();
            updatePreview();
        }
        
        // ============ UI HELPERS ============
        function updateSpeedDisplay() {
            const val = document.getElementById('autoplaySpeed').value;
            document.getElementById('speedValue').textContent = val + ' sec';
        }
        
        function showError(msg) {
            const el = document.getElementById('errorMsg');
            el.innerHTML = msg;
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 5000);
        }
        
        function showSuccess(msg) {
            const el = document.getElementById('successMsg');
            el.innerHTML = msg;
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 3000);
        }
        
        function showLoading(text) {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingOverlay').classList.add('show');
        }
        
        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('show');
        }
        
        // ============ AI GENERATION ============
        async function generateWithAI() {
            const geminiKey = document.getElementById('geminiKey').value.trim();
            const campaignName = document.getElementById('campaignName').value.trim();
            const campaignText = document.getElementById('campaignText').value.trim();
            
            if (!geminiKey) {
                showError('Please enter your Gemini API key. <a href="https://aistudio.google.com/app/apikey" target="_blank">Get one free here ‚Üí</a>');
                return;
            }
            
            if (!campaignName) {
                showError('Please enter your campaign name');
                return;
            }
            
            if (!campaignText) {
                showError('Please paste your campaign description for AI to organize');
                return;
            }
            
            const btn = document.getElementById('generateBtn');
            btn.disabled = true;
            showLoading('AI is analyzing your campaign...');
            
            try {
                const prompt = `You are helping create an iTabs display for a Kickstarter campaign called "${campaignName}".

Here is the campaign description:
---
${campaignText.substring(0, 6000)}
---

Create compelling content for 4 sections. Use ONLY facts from the description above - do not invent anything. Keep each section 2-3 sentences, punchy and backer-focused.

Return ONLY valid JSON in this exact format:
{
    "whatIsIt": "Clear, exciting description of what this product/project is",
    "whyBackIt": "Compelling reasons why someone should back this now - benefits, value, urgency",
    "howWorks": "How the product works or how the campaign/rewards work",
    "whatSpecial": "What makes this unique - differentiators, innovations, special features"
}`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${geminiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }]
                    })
                });
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error.message || 'API error');
                }
                
                if (data.candidates && data.candidates[0]?.content?.parts?.[0]?.text) {
                    const text = data.candidates[0].content.parts[0].text;
                    const jsonMatch = text.match(/\{[\s\S]*\}/);
                    
                    if (jsonMatch) {
                        const content = JSON.parse(jsonMatch[0]);
                        
                        document.getElementById('whatIsIt').value = content.whatIsIt || '';
                        document.getElementById('whyBackIt').value = content.whyBackIt || '';
                        document.getElementById('howWorks').value = content.howWorks || '';
                        document.getElementById('whatSpecial').value = content.whatSpecial || '';
                        
                        saveToStorage();
                        updatePreview();
                        showSuccess('‚ú® Content generated! Edit as needed.');
                    } else {
                        throw new Error('Could not parse AI response');
                    }
                } else {
                    throw new Error('Invalid response from AI');
                }
            } catch (error) {
                console.error('AI Error:', error);
                showError('AI Error: ' + error.message);
            } finally {
                btn.disabled = false;
                hideLoading();
            }
        }
        
        // ============ PREVIEW ============
        function updatePreview() {
            const name = document.getElementById('campaignName').value || 'Your Campaign';
            const url = document.getElementById('campaignUrl').value || '#';
            const images = getImageUrls();
            const whatIsIt = document.getElementById('whatIsIt').value;
            const whyBackIt = document.getElementById('whyBackIt').value;
            const howWorks = document.getElementById('howWorks').value;
            const whatSpecial = document.getElementById('whatSpecial').value;
            const buttonText = document.getElementById('buttonText').value || 'Back This Project';
            const overlayText = document.getElementById('overlayText').value;
            const autoplay = document.getElementById('autoplayToggle').checked;
            const speed = document.getElementById('autoplaySpeed').value;
            
            const amountRaised = document.getElementById('amountRaised').value;
            const fundingGoal = document.getElementById('fundingGoal').value;
            const backerCount = document.getElementById('backerCount').value;
            const daysLeft = document.getElementById('daysLeft').value;
            
            if (images.length === 0) {
                document.getElementById('previewPlaceholder').style.display = 'block';
                document.getElementById('livePreview').classList.remove('show');
                return;
            }
            
            document.getElementById('previewPlaceholder').style.display = 'none';
            document.getElementById('livePreview').classList.add('show');
            
            // Build slides HTML
            let slidesHTML = '';
            let dotsHTML = '';
            images.forEach((img, i) => {
                slidesHTML += `<div style="min-width:100%;height:100%;position:relative;">
                    <img src="${img}" alt="Slide ${i+1}" style="width:100%;height:100%;object-fit:cover;">
                    ${i === 0 && overlayText ? `<div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:white;font-size:24px;font-weight:bold;text-shadow:2px 2px 8px rgba(0,0,0,0.8);text-align:center;padding:10px;max-width:90%;">${overlayText}</div>` : ''}
                </div>`;
                dotsHTML += `<div class="prev-dot" data-i="${i}" style="width:10px;height:10px;border-radius:50%;background:${i===0?'white':'rgba(255,255,255,0.5)'};cursor:pointer;border:2px solid white;"></div>`;
            });
            
            // Build funding stats HTML
            let fundingHTML = '';
            if (amountRaised && fundingGoal) {
                const raised = parseFloat(amountRaised.replace(/[^0-9.]/g, '')) || 0;
                const goal = parseFloat(fundingGoal.replace(/[^0-9.]/g, '')) || 1;
                const pct = Math.min(Math.round((raised / goal) * 100), 100);
                
                fundingHTML = `
                <div style="background:#f7fafc;padding:18px;border-radius:12px;margin-bottom:20px;">
                    <div style="display:flex;justify-content:space-between;margin-bottom:10px;">
                        <div>
                            <div style="font-size:1.6em;font-weight:bold;color:#05CE78;">${amountRaised}</div>
                            <div style="font-size:0.85em;color:#718096;">pledged of ${fundingGoal}</div>
                        </div>
                        ${backerCount ? `<div style="text-align:right;">
                            <div style="font-size:1.6em;font-weight:bold;color:#2d3748;">${backerCount}</div>
                            <div style="font-size:0.85em;color:#718096;">backers</div>
                        </div>` : ''}
                    </div>
                    <div style="background:#e2e8f0;height:8px;border-radius:4px;overflow:hidden;">
                        <div style="background:linear-gradient(135deg,#05CE78,#00A862);height:100%;width:${pct}%;"></div>
                    </div>
                    ${daysLeft ? `<div style="text-align:center;color:#4a5568;font-weight:600;margin-top:12px;">‚è∞ ${daysLeft} days left</div>` : ''}
                </div>`;
            }
            
            // Build popup content
            let popupContent = fundingHTML;
            if (whatIsIt) popupContent += `<div style="margin-bottom:18px;"><h4 style="color:#05CE78;font-size:1.1em;margin-bottom:8px;">üéØ What is it?</h4><p style="color:#4a5568;line-height:1.7;">${whatIsIt}</p></div>`;
            if (whyBackIt) popupContent += `<div style="margin-bottom:18px;"><h4 style="color:#05CE78;font-size:1.1em;margin-bottom:8px;">üí° Why back this?</h4><p style="color:#4a5568;line-height:1.7;">${whyBackIt}</p></div>`;
            if (howWorks) popupContent += `<div style="margin-bottom:18px;"><h4 style="color:#05CE78;font-size:1.1em;margin-bottom:8px;">‚öôÔ∏è How does it work?</h4><p style="color:#4a5568;line-height:1.7;">${howWorks}</p></div>`;
            if (whatSpecial) popupContent += `<div style="margin-bottom:18px;"><h4 style="color:#05CE78;font-size:1.1em;margin-bottom:8px;">‚≠ê What makes it special?</h4><p style="color:#4a5568;line-height:1.7;">${whatSpecial}</p></div>`;
            
            const previewHTML = `
            <div style="background:white;border-radius:16px;overflow:hidden;box-shadow:0 8px 30px rgba(0,0,0,0.12);">
                <div style="position:relative;width:100%;height:280px;overflow:hidden;background:linear-gradient(135deg,#05CE78,#00A862);">
                    <div id="prevTrack" style="display:flex;height:100%;transition:transform 0.4s ease;">
                        ${slidesHTML}
                    </div>
                    <div style="position:absolute;bottom:15px;left:50%;transform:translateX(-50%);display:flex;gap:8px;z-index:15;">
                        ${dotsHTML}
                    </div>
                    <div id="prevCounter" style="position:absolute;bottom:15px;right:15px;background:rgba(0,0,0,0.6);color:white;padding:4px 10px;border-radius:12px;font-size:12px;font-weight:600;">1/${images.length}</div>
                    <div onclick="document.getElementById('prevPopup').style.display='flex'" style="position:absolute;top:15px;right:15px;width:42px;height:42px;background:rgba(255,255,255,0.95);color:#05CE78;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:22px;cursor:pointer;box-shadow:0 4px 15px rgba(0,0,0,0.2);border:3px solid white;z-index:20;">i</div>
                </div>
                <div style="padding:20px;text-align:center;">
                    <h3 style="font-size:1.15em;color:#2d3748;margin-bottom:6px;">${name}</h3>
                    <p style="color:#718096;font-size:0.9em;">Swipe to see more ‚Ä¢ Tap i for details</p>
                </div>
            </div>
            
            <div id="prevPopup" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.75);z-index:1000;align-items:center;justify-content:center;padding:15px;">
                <div style="background:white;border-radius:16px;max-width:420px;width:100%;max-height:80vh;overflow:hidden;">
                    <div style="background:linear-gradient(135deg,#05CE78,#00A862);color:white;padding:22px;position:relative;">
                        <h3 style="font-size:1.25em;margin-bottom:4px;">${name}</h3>
                        <p style="opacity:0.9;font-size:0.9em;">Campaign Details</p>
                        <button onclick="document.getElementById('prevPopup').style.display='none'" style="position:absolute;top:12px;right:12px;width:30px;height:30px;background:rgba(255,255,255,0.2);border:none;border-radius:50%;color:white;font-size:18px;cursor:pointer;">√ó</button>
                    </div>
                    <div style="padding:22px;max-height:calc(80vh - 100px);overflow-y:auto;">
                        ${popupContent}
                        <a href="${url}" target="_blank" style="display:block;width:100%;padding:14px;background:linear-gradient(135deg,#05CE78,#00A862);color:white;text-align:center;text-decoration:none;border-radius:10px;font-weight:600;margin-top:20px;">${buttonText}</a>
                    </div>
                </div>
            </div>`;
            
            document.getElementById('livePreview').innerHTML = previewHTML;
            
            // Setup preview interactions
            setupPreviewInteractions(images.length, autoplay, speed);
        }
        
        function setupPreviewInteractions(total, autoplay, speed) {
            let current = 0;
            
            const update = () => {
                const track = document.getElementById('prevTrack');
                const counter = document.getElementById('prevCounter');
                const dots = document.querySelectorAll('.prev-dot');
                
                if (track) track.style.transform = `translateX(-${current * 100}%)`;
                if (counter) counter.textContent = `${current + 1}/${total}`;
                dots.forEach((d, i) => d.style.background = i === current ? 'white' : 'rgba(255,255,255,0.5)');
            };
            
            // Dot clicks
            document.querySelectorAll('.prev-dot').forEach(dot => {
                dot.addEventListener('click', () => {
                    current = parseInt(dot.dataset.i);
                    update();
                });
            });
            
            // Touch swipe
            const track = document.getElementById('prevTrack');
            let startX = 0;
            if (track) {
                track.addEventListener('touchstart', e => startX = e.changedTouches[0].screenX);
                track.addEventListener('touchend', e => {
                    const diff = startX - e.changedTouches[0].screenX;
                    if (Math.abs(diff) > 50) {
                        current = diff > 0 ? (current + 1) % total : (current - 1 + total) % total;
                        update();
                    }
                });
            }
            
            // Popup close on overlay click
            const popup = document.getElementById('prevPopup');
            if (popup) {
                popup.addEventListener('click', e => {
                    if (e.target.id === 'prevPopup') popup.style.display = 'none';
                });
            }
            
            // Autoplay
            if (autoplay && total > 1) {
                setInterval(() => {
                    current = (current + 1) % total;
                    update();
                }, speed * 1000);
            }
        }
        
        // ============ CODE GENERATION ============
        function generateCode() {
            const name = document.getElementById('campaignName').value || 'Campaign';
            const url = document.getElementById('campaignUrl').value || '#';
            const images = getImageUrls();
            const whatIsIt = document.getElementById('whatIsIt').value;
            const whyBackIt = document.getElementById('whyBackIt').value;
            const howWorks = document.getElementById('howWorks').value;
            const whatSpecial = document.getElementById('whatSpecial').value;
            const buttonText = document.getElementById('buttonText').value || 'Back This Project';
            const overlayText = document.getElementById('overlayText').value;
            const autoplay = document.getElementById('autoplayToggle').checked;
            const speed = document.getElementById('autoplaySpeed').value;
            const amountRaised = document.getElementById('amountRaised').value;
            const fundingGoal = document.getElementById('fundingGoal').value;
            const backerCount = document.getElementById('backerCount').value;
            const daysLeft = document.getElementById('daysLeft').value;
            
            if (images.length === 0) {
                showError('Please add at least one image');
                return;
            }
            
            // Build slides
            let slidesCode = '';
            let dotsCode = '';
            images.forEach((img, i) => {
                slidesCode += `                <div style="min-width:100%;height:100%;position:relative;">
                    <img src="${img}" alt="${name} ${i+1}" style="width:100%;height:100%;object-fit:cover;">
                    ${i === 0 && overlayText ? `<div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:white;font-size:28px;font-weight:bold;text-shadow:2px 2px 8px rgba(0,0,0,0.8);text-align:center;padding:10px;max-width:90%;">${overlayText}</div>` : ''}
                </div>\n`;
                dotsCode += `            <div class="itabs-dot" style="width:10px;height:10px;border-radius:50%;background:${i===0?'white':'rgba(255,255,255,0.5)'};cursor:pointer;border:2px solid white;transition:all 0.3s;"></div>\n`;
            });
            
            // Build funding stats
            let fundingCode = '';
            if (amountRaised && fundingGoal) {
                const raised = parseFloat(amountRaised.replace(/[^0-9.]/g, '')) || 0;
                const goal = parseFloat(fundingGoal.replace(/[^0-9.]/g, '')) || 1;
                const pct = Math.min(Math.round((raised / goal) * 100), 100);
                
                fundingCode = `
            <div style="background:#f7fafc;padding:18px;border-radius:12px;margin-bottom:20px;">
                <div style="display:flex;justify-content:space-between;margin-bottom:10px;">
                    <div>
                        <div style="font-size:1.6em;font-weight:bold;color:#05CE78;">${amountRaised}</div>
                        <div style="font-size:0.85em;color:#718096;">pledged of ${fundingGoal}</div>
                    </div>
                    ${backerCount ? `<div style="text-align:right;">
                        <div style="font-size:1.6em;font-weight:bold;color:#2d3748;">${backerCount}</div>
                        <div style="font-size:0.85em;color:#718096;">backers</div>
                    </div>` : ''}
                </div>
                <div style="background:#e2e8f0;height:8px;border-radius:4px;overflow:hidden;">
                    <div style="background:linear-gradient(135deg,#05CE78,#00A862);height:100%;width:${pct}%;"></div>
                </div>
                ${daysLeft ? `<div style="text-align:center;color:#4a5568;font-weight:600;margin-top:12px;">‚è∞ ${daysLeft} days left</div>` : ''}
            </div>`;
            }
            
            // Build popup content
            let popupCode = fundingCode;
            if (whatIsIt) popupCode += `            <div style="margin-bottom:18px;"><h4 style="color:#05CE78;font-size:1.1em;margin-bottom:8px;">üéØ What is it?</h4><p style="color:#4a5568;line-height:1.7;">${whatIsIt}</p></div>\n`;
            if (whyBackIt) popupCode += `            <div style="margin-bottom:18px;"><h4 style="color:#05CE78;font-size:1.1em;margin-bottom:8px;">üí° Why back this?</h4><p style="color:#4a5568;line-height:1.7;">${whyBackIt}</p></div>\n`;
            if (howWorks) popupCode += `            <div style="margin-bottom:18px;"><h4 style="color:#05CE78;font-size:1.1em;margin-bottom:8px;">‚öôÔ∏è How does it work?</h4><p style="color:#4a5568;line-height:1.7;">${howWorks}</p></div>\n`;
            if (whatSpecial) popupCode += `            <div style="margin-bottom:18px;"><h4 style="color:#05CE78;font-size:1.1em;margin-bottom:8px;">‚≠ê What makes it special?</h4><p style="color:#4a5568;line-height:1.7;">${whatSpecial}</p></div>\n`;
            
            const code = `<!-- iTabs for Kickstarter - Generated by itabs.ai -->
<div style="background:white;border-radius:20px;overflow:hidden;box-shadow:0 10px 40px rgba(0,0,0,0.12);max-width:500px;margin:20px auto;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;">
    <div style="position:relative;width:100%;height:350px;overflow:hidden;background:linear-gradient(135deg,#05CE78,#00A862);">
        <div id="itabsTrack" style="display:flex;height:100%;transition:transform 0.4s ease;">
${slidesCode}        </div>
        <div style="position:absolute;bottom:15px;left:50%;transform:translateX(-50%);display:flex;gap:8px;z-index:15;">
${dotsCode}        </div>
        <div id="itabsCounter" style="position:absolute;bottom:15px;right:15px;background:rgba(0,0,0,0.6);color:white;padding:5px 12px;border-radius:15px;font-size:14px;font-weight:bold;">1/${images.length}</div>
        <div onclick="document.getElementById('itabsPopup').style.display='flex'" style="position:absolute;top:18px;right:18px;width:45px;height:45px;background:rgba(255,255,255,0.95);color:#05CE78;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:24px;cursor:pointer;box-shadow:0 4px 20px rgba(0,0,0,0.2);border:3px solid white;z-index:20;">i</div>
    </div>
    <div style="padding:22px;text-align:center;">
        <h3 style="font-size:1.25em;color:#2d3748;margin:0 0 8px 0;">${name}</h3>
        <p style="color:#718096;font-size:0.95em;margin:0;">Swipe to see more ‚Ä¢ Tap i for details</p>
    </div>
</div>

<!-- Popup -->
<div id="itabsPopup" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.8);z-index:1000;align-items:center;justify-content:center;padding:15px;">
    <div style="background:white;border-radius:20px;max-width:500px;width:90%;max-height:85vh;overflow:hidden;">
        <div style="background:linear-gradient(135deg,#05CE78,#00A862);color:white;padding:26px;position:relative;">
            <h3 style="font-size:1.4em;margin:0 0 4px 0;">${name}</h3>
            <p style="opacity:0.9;font-size:0.95em;margin:0;">Campaign Details</p>
            <button onclick="document.getElementById('itabsPopup').style.display='none'" style="position:absolute;top:14px;right:14px;width:34px;height:34px;background:rgba(255,255,255,0.2);border:none;border-radius:50%;color:white;font-size:22px;cursor:pointer;">√ó</button>
        </div>
        <div style="padding:26px;max-height:calc(85vh - 100px);overflow-y:auto;">
${popupCode}            <a href="${url}" target="_blank" style="display:block;width:100%;padding:16px;background:linear-gradient(135deg,#05CE78,#00A862);color:white;text-align:center;text-decoration:none;border-radius:12px;font-weight:600;font-size:1.05em;margin-top:24px;box-sizing:border-box;">${buttonText}</a>
        </div>
    </div>
</div>

<!-- iTabs Info Button -->
<div onclick="document.getElementById('itabsInfoPopup').style.display='flex'" style="position:fixed;bottom:20px;right:20px;width:40px;height:40px;background:white;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:0 4px 15px rgba(0,0,0,0.15);border:2px solid #05CE78;cursor:pointer;z-index:999;">
    <div style="color:#05CE78;font-size:16px;font-weight:bold;line-height:1;">i</div>
    <div style="color:#05CE78;font-size:7px;font-weight:600;text-transform:uppercase;">iTabs</div>
</div>

<!-- iTabs Info Popup -->
<div id="itabsInfoPopup" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.8);z-index:1001;align-items:center;justify-content:center;padding:15px;">
    <div style="background:white;border-radius:20px;max-width:400px;width:90%;overflow:hidden;">
        <div style="background:linear-gradient(135deg,#05CE78,#00A862);color:white;padding:22px;position:relative;">
            <h3 style="font-size:1.3em;margin:0;">‚ú® Made with iTabs</h3>
            <button onclick="document.getElementById('itabsInfoPopup').style.display='none'" style="position:absolute;top:12px;right:12px;width:30px;height:30px;background:rgba(255,255,255,0.2);border:none;border-radius:50%;color:white;font-size:18px;cursor:pointer;">√ó</button>
        </div>
        <div style="padding:24px;">
            <p style="color:#4a5568;line-height:1.7;margin:0 0 20px 0;">This interactive display was created with iTabs - making campaigns impossible to ignore.</p>
            <a href="https://itabs.ai/kickstarter" target="_blank" style="display:block;width:100%;padding:14px;background:linear-gradient(135deg,#05CE78,#00A862);color:white;text-align:center;text-decoration:none;border-radius:10px;font-weight:600;box-sizing:border-box;">Create Your Own iTabs ‚Üí</a>
        </div>
    </div>
</div>

<script>
(function(){
    var c=0,t=${images.length};
    function u(){
        var tr=document.getElementById('itabsTrack'),ct=document.getElementById('itabsCounter'),ds=document.querySelectorAll('.itabs-dot');
        if(tr)tr.style.transform='translateX(-'+(c*100)+'%)';
        if(ct)ct.textContent=(c+1)+'/'+t;
        ds.forEach(function(d,i){d.style.background=i===c?'white':'rgba(255,255,255,0.5)';});
    }
    var tr=document.getElementById('itabsTrack'),sx=0;
    if(tr){
        tr.addEventListener('touchstart',function(e){sx=e.changedTouches[0].screenX;});
        tr.addEventListener('touchend',function(e){
            var d=sx-e.changedTouches[0].screenX;
            if(Math.abs(d)>50){c=d>0?(c+1)%t:(c-1+t)%t;u();}
        });
    }
    document.querySelectorAll('.itabs-dot').forEach(function(d,i){d.addEventListener('click',function(){c=i;u();});});
    ['itabsPopup','itabsInfoPopup'].forEach(function(id){
        var el=document.getElementById(id);
        if(el)el.addEventListener('click',function(e){if(e.target.id===id)el.style.display='none';});
    });
    ${autoplay && images.length > 1 ? `setInterval(function(){c=(c+1)%t;u();},${speed * 1000});` : ''}
})();
</script>`;

            document.getElementById('codeOutput').textContent = code;
            document.getElementById('codeSection').classList.add('show');
            document.getElementById('codeSection').scrollIntoView({ behavior: 'smooth' });
            showSuccess('‚úÖ Code generated! Copy or download below.');
        }
        
        function copyCode() {
            const code = document.getElementById('codeOutput').textContent;
            navigator.clipboard.writeText(code).then(() => {
                showSuccess('‚úÖ Code copied to clipboard!');
            }).catch(() => {
                // Fallback
                const ta = document.createElement('textarea');
                ta.value = code;
                ta.style.position = 'fixed';
                ta.style.opacity = '0';
                document.body.appendChild(ta);
                ta.select();
                try {
                    document.execCommand('copy');
                    showSuccess('‚úÖ Code copied!');
                } catch (e) {
                    showError('Copy failed - please select and copy manually');
                }
                document.body.removeChild(ta);
            });
        }
        
        function downloadHTML() {
            const code = document.getElementById('codeOutput').textContent;
            const name = document.getElementById('campaignName').value || 'campaign';
            const fullHTML = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${name} - iTabs</title>
</head>
<body style="margin:0;padding:20px;background:#f5f5f5;min-height:100vh;">
${code}
</body>
</html>`;
            
            const blob = new Blob([fullHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${name.toLowerCase().replace(/\s+/g, '-')}-itabs.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showSuccess('‚úÖ Downloaded!');
        }
        
        // ============ INIT ============
        document.addEventListener('DOMContentLoaded', () => {
            loadFromStorage();
            updateSpeedDisplay();
        });
    </script>
</body>
</html>
